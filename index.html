<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PATROL - Jogo de Perguntas e Respostas</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/performance.css">
    <style>
        /* ESTILOS TEMPOR√ÅRIOS PARA LOBBY (depois movemos para style.css) */
        #lobby-screen {
            background: linear-gradient(135deg, #002244 0%, #003366);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .lobby-container {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            border: 4px solid #FFCC00;
            max-width: 600px;
            width: 100%;
            text-align: center;
        }
        
        .lobby-container h2 {
            color: #003366;
            margin-bottom: 30px;
            font-size: 1.8em;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .lobby-options {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .lobby-option {
            padding: 25px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 3px solid #dee2e6;
        }
        
        .lobby-option h3 {
            color: #003366;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        .lobby-btn {
            background: linear-gradient(145deg, #003366, #002244);
            color: #FFCC00 !important;
            border: 3px solid #FFCC00;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 800;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }
        
        .lobby-btn:hover {
            background: linear-gradient(145deg, #002244, #001933);
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .lobby-input {
            padding: 16px;
            border: 3px solid #dee2e6;
            border-radius: 12px;
            font-size: 16px;
            width: 100%;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
            letter-spacing: 2px;
            text-transform: uppercase;
        }
        
        .lobby-input:focus {
            border-color: #003366;
            outline: none;
            box-shadow: 0 0 0 3px rgba(0,51,102,0.2);
        }
        
        #room-info {
            background: #e9ecef;
            padding: 20px;
            border-radius: 15px;
            border: 3px solid #28a745;
            margin-top: 20px;
        }
        
        #current-room-code {
            background: #003366;
            color: #FFCC00;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 1.5em;
            font-weight: 900;
            letter-spacing: 3px;
            display: inline-block;
            margin: 0 10px;
        }
        
        .player-item {
            background: white;
            padding: 10px 15px;
            margin: 8px 0;
            border-radius: 8px;
            border-left: 4px solid #003366;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .player-item:before {
            content: "üë§";
        }
        
        .back-to-lobby {
            position: absolute;
            top: 20px;
            left: 20px;
            background: linear-gradient(145deg, #6c757d, #5a6268);
            border-color: #545b62;
            color: #FFCC00;
            padding: 10px 20px;
            font-size: 14px;
        }
        
        @media (max-width: 768px) {
            .lobby-options {
                flex-direction: column;
            }
            
            .lobby-container {
                padding: 25px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ===== TELA DE LOGIN ===== -->
        <div id="login-screen" class="screen active">
            <h1>PATROL</h1>
            
            <div class="login-container">
                <h2>üîê Entrar no Jogo</h2>
                
                <div class="login-form">
                    <input type="email" id="login-email" placeholder="Seu email" class="login-input">
                    <input type="password" id="login-password" placeholder="Sua senha" class="login-input">
                    <button id="login-btn" class="login-btn">üéÆ Entrar</button>
                    <button id="signup-btn" class="signup-btn">üìù Criar Conta</button>
                    <button id="reset-btn" class="reset-btn">üîì Esqueci a senha</button>
                </div>
                
                <div class="login-options">
                    <p>Ou entre com:</p>
                    <button id="google-login-btn" class="google-btn">
                        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
                        Conta Google
                    </button>
                </div>
                
                <div class="login-error" id="login-error"></div>
            </div>
        </div>

        <!-- ===== TELA DE LOBBY (NOVA) ===== -->
        <div id="lobby-screen" class="screen">
            <button id="back-to-lobby-login" class="back-to-lobby">‚Üê Voltar</button>
            
            <h1>PATROL</h1>
            
            <div class="lobby-container">
                <h2>üéÆ Sala de Jogo</h2>
                
                <div class="lobby-options">
                    <!-- Criar Nova Sala -->
                    <div class="lobby-option">
                        <h3>üèÅ Criar Nova Partida</h3>
                        <button id="create-room-btn" class="lobby-btn">
                            Criar como Mestre üëë
                        </button>
                        <p style="margin-top: 10px; color: #666; font-size: 14px;">
                            Voc√™ controla o jogo e as perguntas
                        </p>
                    </div>
                    
                    <!-- Entrar em Sala Existente -->
                    <div class="lobby-option">
                        <h3>üîë Entrar na Partida</h3>
                        <input type="text" id="room-code" placeholder="Digite o c√≥digo" class="lobby-input" maxlength="6">
                        <button id="join-room-btn" class="lobby-btn">
                            Entrar como Jogador üéÆ
                        </button>
                        <p style="margin-top: 10px; color: #666; font-size: 14px;">
                            Pe√ßa o c√≥digo para quem criou a partida
                        </p>
                    </div>
                </div>
                
                <!-- C√≥digo da Sala (quando mestre) -->
                <div id="room-info" style="display: none;">
                    <h3>üìã C√≥digo da Sala: <span id="current-room-code">ABC123</span></h3>
                    <p style="color: #28a745; font-weight: bold;">‚úî Compartilhe este c√≥digo com os jogadores</p>
                    <div id="players-list"></div>
                    <button id="start-game-btn-lobby" class="lobby-btn" style="background: linear-gradient(145deg, #28a745, #1e7e34); margin-top: 20px;">
                        üöÄ Iniciar Jogo
                    </button>
                </div>
            </div>
        </div>

        <!-- ===== TELA DE CONFIGURA√á√ÉO (APENAS MESTRE) ===== -->
        <div id="config-screen" class="screen">
            <button id="back-to-lobby-config" class="back-to-lobby">‚Üê Voltar ao Lobby</button>
            <button id="logout-btn" class="logout-btn" style="display: none;">üö™ Sair</button>
            
            <h1>PATROL - Configura√ß√£o do Mestre</h1>
            
            <div class="config-main-area">
                <div class="team-config">
                    <h3>Equipes</h3>
                    <div id="teams-container">
                        <div class="team-input">
                            <input type="text" placeholder="Nome da Equipe" value="ALFA">
                            <input type="text" placeholder="Jogadores (opcional)">
                            <button class="remove-team" onclick="removeTeam(this)">üóëÔ∏è</button>
                        </div>
                    </div>
                    <button id="add-team-btn">‚ûï Adicionar Equipe</button>
                    <div id="team-error" class="error-message">‚ö†Ô∏è Configure pelo menos uma equipe</div>
                </div>

                <div class="file-upload-container">
                    <div class="file-upload">
                        <h3>Perguntas</h3>
                        <input type="file" id="excel-file" accept=".xlsx, .xls">
                        <div id="file-status">üìÅ Nenhum arquivo selecionado</div>
                        <div id="file-error" class="error-message">‚ö†Ô∏è Carregue um arquivo de perguntas</div>
                        
                        <div class="checkbox-container">
                            <input type="checkbox" id="random-order">
                            <label for="random-order">Ordem aleat√≥ria de perguntas e equipes</label>
                        </div>
                    </div>

                    <div class="subjects-config">
                        <h3>Assuntos Carregados</h3>
                        <div class="subjects-controls">
                            <button onclick="toggleAllSubjects(true)" class="subjects-btn">‚úì Selecionar Todos</button>
                            <button onclick="toggleAllSubjects(false)" class="subjects-btn">‚úó Desmarcar Todos</button>
                            <button onclick="clearAllSubjects()" class="subjects-btn">üóëÔ∏è Limpar Tudo</button>
                        </div>
                        <div id="subjects-container" class="subjects-container">
                            <div class="no-subjects">Nenhum assunto carregado</div>
                        </div>
                    </div>

                    <div class="performance-config-container">
                        <div>
                            <span>üìä</span> Performance por Assunto
                            <div class="performance-header-controls">
                                <button onclick="exportPerformanceToExcel()" class="performance-header-btn" title="Exportar Performance">
                                    üì•
                                </button>
                                <button onclick="triggerPerformanceImport()" class="performance-header-btn" title="Importar Performance">
                                    üì§
                                </button>
                            </div>
                        </div>
                        <div>
                            Importe/exporte dados de performance para acompanhamento hist√≥rico.
                        </div>
                        <div>
                            Os dados s√£o salvos automaticamente durante o jogo.
                        </div>
                        <input type="file" id="import-performance-file" accept=".csv">
                    </div>

                    <button id="start-game-btn" disabled>üéÆ Iniciar Jogo para Todos</button>
                    
                    <div class="ranking-button-container">
                        <button id="open-notes-config" class="notes-btn">üìù Bloco de Notas</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== TELA DO JOGO (TODOS OS JOGADORES) ===== -->
        <div id="game-screen" class="screen">
            <button id="back-to-lobby-game" class="back-to-lobby">‚Üê Sair da Partida</button>
            
            <h1>PATROL <span id="game-status" style="font-size: 0.6em; color: #FFCC00;">‚óè Conectado</span></h1>
            
            <div class="question-main-area">
                <div class="question-area">
                    <div class="question-header">
                        <div class="question-counter">
                            Pergunta <span id="question-number">1</span>/<span id="total-questions">0</span>
                        </div>
                        <div id="team-turn" class="team-turn">üéØ Aguardando in√≠cio...</div>
                        <div class="question-header-buttons">
                            <button id="open-notes-btn" class="notes-btn">üìù Notas</button>
                            <div id="master-controls" style="display: none;">
                                <button id="master-next-btn" class="config-btn">‚è≠Ô∏è Avan√ßar</button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="question-text">Aguardando o mestre iniciar o jogo...</div>
                    
                    <div class="answer-buttons">
                        <button id="certo-btn" class="answer-btn certo-btn">‚úÖ CERTO</button>
                        <button id="errado-btn" class="answer-btn errado-btn">‚ùå ERRADO</button>
                        <button id="skip-btn" class="skip-btn">‚è≠Ô∏è Pular</button>
                        <button id="next-question-btn" class="next-btn" style="display: none;">‚è≠Ô∏è Pr√≥xima</button>
                        <button id="podium-btn" class="podium-btn" style="display: none;">üèÜ P√≥dio</button>
                    </div>
                    
                    <div id="correct-answer" class="correct-answer"></div>
                    <div id="commentary" class="commentary"></div>
                </div>

                <div class="active-team-sidebar">
                    <div id="active-team-display"></div>
                    <!-- Placar em tempo real -->
                    <div id="live-scoreboard" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px; border: 2px solid #003366;">
                        <h4 style="color: #003366; margin-bottom: 10px;">üèÜ Placar ao Vivo</h4>
                        <div id="scoreboard-content"></div>
                    </div>
                </div>
            </div>

            <div class="teams-area">
                <div id="teams-display"></div>
            </div>
            
            <!-- Chat simples -->
            <div id="game-chat" style="max-width: 800px; margin: 20px auto; display: none;">
                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border: 2px solid #dee2e6;">
                    <h4 style="color: #003366; margin-bottom: 10px;">üí¨ Chat da Partida</h4>
                    <div id="chat-messages" style="height: 150px; overflow-y: auto; margin-bottom: 10px; padding: 10px; background: white; border-radius: 5px;"></div>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="chat-input" placeholder="Digite uma mensagem..." style="flex: 1; padding: 10px; border: 2px solid #dee2e6; border-radius: 5px;">
                        <button id="send-chat-btn" style="background: #003366; color: #FFCC00; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Enviar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== TELA DE P√ìDIO ===== -->
        <div id="podium-screen" class="screen">
            <h1>PATROL</h1>
            <div class="podium-screen">
                <div class="podium-title">üèÜ P√ìDIO</div>
                <div id="podium-container" class="podium-container"></div>
            </div>
        </div>
    </div>

    <!-- ===== MODAL DE NOTAS ===== -->
    <div id="notes-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìù Bloco de Notas</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="notes-tabs-container">
                    <div class="notes-tabs" id="notes-tabs"></div>
                </div>
                <div class="notes-content" id="notes-content"></div>
                <div class="notes-controls">
                    <button id="save-notes" class="notes-action-btn">üíæ Salvar Tudo</button>
                    <button id="export-notes" class="notes-action-btn">üì• Exportar Tudo</button>
                    <button id="import-notes" class="notes-action-btn">üì§ Importar Tudo</button>
                    <button id="clear-notes" class="notes-action-btn">üóëÔ∏è Limpar Esta Aba</button>
                </div>
                <input type="file" id="import-notes-file" accept=".json">
            </div>
        </div>
    </div>

    <!-- ===== BIBLIOTECAS EXTERNAS ===== -->
    <!-- Biblioteca XLSX (SEMPRE primeiro) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-database-compat.js"></script>

    <script>
        // CONFIGURA√á√ïES DO FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyAW2k1dGsT1a23_9BTHnMM6UV5mo85GfoI",
            authDomain: "patrol-6cfc0.firebaseapp.com",
            projectId: "patrol-6cfc0",
            storageBucket: "patrol-6cfc0.firebasestorage.app",
            messagingSenderId: "79534174974",
            appId: "1:79534174974:web:78ad46f7b8f4e71c0d6baf",
            measurementId: "G-CFGFH5EPB2"
        };
        
        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        
        // Tornar dispon√≠vel globalmente
        window.firebase = firebase;
        window.auth = firebase.auth();
        window.db = firebase.database();
        
        console.log('‚úÖ Firebase configurado!');
    </script>

    <!-- AUTH.JS COM LOBBY -->
    <script src="js/auth.js"></script>

    <!-- SISTEMA DE SALAS (NOVO) -->
    <script src="js/rooms.js"></script>

    <!-- ===== JAVASCRIPT DO JOGO ===== -->
    <!-- ORDEM CR√çTICA DE CARREGAMENTO -->
    <script src="js/external.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/teams.js"></script>
    <script src="js/teams-performance/core.js"></script>
    <script src="js/teams-performance/tracking.js"></script>
    <script src="js/teams-performance/import-export.js"></script>
    <script src="js/teams-performance/display.js"></script>
    <script src="js/teams-performance/init.js"></script>
    <script src="js/game/core.js"></script>
    <script src="js/answers/core.js"></script>
    <script src="js/answers/correct.js"></script>
    <script src="js/answers/wrong.js"></script>
    <script src="js/answers/skip.js"></script>
    <script src="js/answers/checkAnswer.js"></script>
    <script src="js/answers/winner.js"></script>
    <script src="js/game/podium.js"></script>
    <script src="js/game/notes.js"></script>
    <script src="js/bombQuestion/penaltyModal.js"></script>
    <script src="js/bombQuestion/fileLoader.js"></script>
    <script src="js/bombQuestion/ui-manager.js"></script>
    <script src="js/bombQuestion/selector.js"></script>
    <script src="js/bombQuestion/game-manager.js"></script>
    <script src="js/bombQuestion/core-base.js"></script>
    <script src="js/bombQuestion/config.js"></script>
    <script src="js/bombQuestion/main.js"></script>
    <script src="js/fileUpload/main.js"></script>
    <script src="js/fileUpload/core.js"></script>
    <script src="js/fileUpload/subjects.js"></script>
    <script src="js/fileUpload/status.js"></script>
    <script src="js/gameEvents/main.js"></script>
    <script src="js/gameEvents/core.js"></script>
    <script src="js/gameEvents/answerButtons.js"></script>
    <script src="js/gameEvents/controlButtons.js"></script>
    <script src="js/gameEvents/teamTurn.js"></script>
    <script src="js/gameEvents/keyboard.js"></script>
    <script src="js/main/buttonTester.js"></script>
    <script src="js/main/notesLoader.js"></script>
    <script src="js/main/configEvents.js"></script>
    <script src="js/main/configScreen.js"></script>
    <script src="js/main/gameStart.js"></script>
    <script src="js/debug.js"></script>
    
    <!-- MULTIPLAYER (NOVO) -->
    <script src="js/game/multiplayer.js"></script>
    
    <!-- Inicializa√ß√£o do Sistema -->
    <script src="js/main/init.js"></script>
    
    <!-- INICIALIZAR SISTEMA DE SALAS -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar sistema de salas quando auth estiver pronto
            setTimeout(() => {
                if (window.authSystem && window.authSystem.currentUser) {
                    window.roomSystem = new RoomSystem();
                    console.log('‚úÖ Sistema de salas inicializado');
                }
            }, 1000);
        });
    </script>
</body>
</html>