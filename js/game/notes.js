if(!window.NotesSystem){window.NotesSystem=class{constructor(){this.fileName='patrol-notes.json',this.localKey='game-notes',this.autoSave=!0,this.currentTab='assunto1',this.tabCounter=1,this.init()}init(){this.setupEventListeners(),this.createTabs(),this.loadNotes()}setupEventListeners(){document.addEventListener('click',a=>{const e=a.target;if(e.id==='open-notes-btn'||e.id==='open-notes-config')this.openNotes();else if(e.classList.contains('close-modal'))this.closeNotes();else if(e.id==='save-notes'){a.preventDefault(),this.saveNotes(!0)}else if(e.id==='export-notes'){a.preventDefault(),this.exportNotes()}else if(e.id==='import-notes'){a.preventDefault(),document.getElementById('import-notes-file').click()}else if(e.id==='clear-notes'){a.preventDefault(),this.clearCurrentTab()}else if(e.classList.contains('add-tab-btn'))this.addNewTab();else if(e.classList.contains('remove-tab')){a.stopPropagation(),this.removeTab(e.dataset.tab)}else if(e.classList.contains('rename-tab')){a.stopPropagation(),this.renameTab(e.dataset.tab)}else if(e.classList.contains('notes-tab')&&!e.classList.contains('add-tab-btn'))this.switchTab(e.dataset.tab);else if(e.classList.contains('tab-name')){const r=e.closest('.notes-tab');r&&!r.classList.contains('add-tab-btn')&&this.switchTab(r.dataset.tab)}}),document.getElementById('notes-modal')?.addEventListener('click',a=>{a.target.id==='notes-modal'&&this.closeNotes()}),document.getElementById('import-notes-file')?.addEventListener('change',a=>this.importNotes(a)),document.addEventListener('input',a=>{a.target.classList.contains('notes-textarea')&&this.autoSave&&this.saveNotes(!1)})}createTabs(){const a=document.getElementById('notes-tabs'),e=document.getElementById('notes-content');if(!a||!e)return;a.innerHTML='',e.innerHTML='';[{id:'assunto1',name:'Assunto 1'},{id:'assunto2',name:'Assunto 2'},{id:'assunto3',name:'Assunto 3'}].forEach(r=>this.createTabElement(r.id,r.name));const r=document.createElement('button');r.className='notes-tab add-tab-btn',r.innerHTML='+',r.title='Adicionar nova aba',a.appendChild(r),this.tabCounter=4,this.switchTab('assunto1')}createTabElement(a,e){const r=document.getElementById('notes-tabs'),t=document.getElementById('notes-content');if(!r||!t)return;const o=document.createElement('button');o.className='notes-tab',o.dataset.tab=a,o.innerHTML=`<span class="tab-name">${e}</span><span class="rename-tab" data-tab="${a}" title="Renomear">✏️</span><span class="remove-tab" data-tab="${a}" title="Remover">×</span>`,o.addEventListener('click',t=>{!t.target.classList.contains('remove-tab')&&!t.target.classList.contains('rename-tab')&&this.switchTab(a)});const n=r.querySelector('.add-tab-btn');n?r.insertBefore(o,n):r.appendChild(o);const l=document.createElement('div');l.className='notes-tab-content',l.id=`tab-${a}`,l.innerHTML=`<textarea class="notes-textarea" placeholder="Digite sobre ${e}..." data-tab="${a}"></textarea>`,t.appendChild(l)}switchTab(a){document.querySelectorAll('.notes-tab, .notes-tab-content').forEach(e=>e.classList.remove('active'));const e=document.querySelector(`.notes-tab[data-tab="${a}"]`),r=document.getElementById(`tab-${a}`);e&&r&&(e.classList.add('active'),r.classList.add('active'),this.currentTab=a,setTimeout(()=>r.querySelector('.notes-textarea')?.focus(),50))}addNewTab(){const a=`assunto${this.tabCounter}`,e=`Assunto ${this.tabCounter}`;this.createTabElement(a,e),this.switchTab(a),this.tabCounter++}removeTab(a){if(document.querySelectorAll('.notes-tab:not(.add-tab-btn)').length<=1)return void alert('❌ Mantenha pelo menos uma aba!');const e=this.getTabName(a);confirm(`⚠️ Remover "${e}"?`)&&(document.querySelector(`.notes-tab[data-tab="${a}"]`)?.remove(),document.getElementById(`tab-${a}`)?.remove(),document.querySelector('.notes-tab:not(.add-tab-btn)')&&this.switchTab(document.querySelector('.notes-tab:not(.add-tab-btn)').dataset.tab),this.saveNotes(!1))}renameTab(a){const e=this.getTabName(a),r=prompt('Novo nome:',e);r?.trim()&&r!==e&&(document.querySelector(`.notes-tab[data-tab="${a}"] .tab-name`).textContent=r.trim(),document.querySelector(`#tab-${a} .notes-textarea`).placeholder=`Digite sobre ${r.trim()}...`,this.saveNotes(!1),alert('✅ Nome atualizado!'))}getTabName(a){const e=document.querySelector(`.notes-tab[data-tab="${a}"] .tab-name`);return e?.textContent||`Assunto ${a.replace('assunto','')}`}openNotes(){const a=document.getElementById('notes-modal');a&&(a.style.display='block',setTimeout(()=>this.switchTab(this.currentTab),100))}closeNotes(){this.saveNotes(!1),document.getElementById('notes-modal').style.display='none'}loadNotes(){const a=localStorage.getItem(this.localKey);if(a)try{const e=JSON.parse(a);Object.keys(e).forEach(r=>{r.endsWith('_name')?document.querySelector(`.notes-tab[data-tab="${r.replace('_name','')}"] .tab-name`).textContent=e[r]:document.querySelector(`#tab-${r} .notes-textarea`).value=e[r]})}catch{}}saveNotes(a=!1){const e={};document.querySelectorAll('.notes-textarea').forEach(r=>{r.dataset.tab&&(e[r.dataset.tab]=r.value)}),document.querySelectorAll('.notes-tab:not(.add-tab-btn)').forEach(r=>{const t=r.dataset.tab,o=r.querySelector('.tab-name');o&&(e[`${t}_name`]=o.textContent)}),localStorage.setItem(this.localKey,JSON.stringify(e)),a&&alert('✅ Notas salvas!')}exportNotes(){const a={};document.querySelectorAll('.notes-textarea').forEach(e=>{e.dataset.tab&&(a[e.dataset.tab]=e.value)}),document.querySelectorAll('.notes-tab:not(.add-tab-btn)').forEach(e=>{const r=e.dataset.tab,t=e.querySelector('.tab-name');t&&(a[`${r}_name`]=t.textContent)});const e=Object.values(a).filter(e=>typeof e==='string'&&!e.endsWith('_name')).some(e=>e.trim());if(!e)return void alert('❌ Nenhuma nota para exportar!');const r=new Blob([JSON.stringify(a,null,2)],{type:'application/json'}),t=URL.createObjectURL(r),o=document.createElement('a');o.href=t,o.download=this.fileName,o.click(),URL.revokeObjectURL(t),alert('✅ Notas exportadas!')}importNotes(a){const e=a.target.files[0];if(!e)return;const r=new FileReader;r.onload=a=>{try{const e=JSON.parse(a.target.result);Object.keys(e).forEach(r=>{r.endsWith('_name')?document.querySelector(`.notes-tab[data-tab="${r.replace('_name','')}"] .tab-name`).textContent=e[r]:document.querySelector(`#tab-${r} .notes-textarea`).value=e[r]}),this.saveNotes(!1),alert('✅ Notas importadas!')}catch{alert('❌ Arquivo inválido!')}},r.readAsText(e),a.target.value=''}clearCurrentTab(){const a=document.querySelector(`#tab-${this.currentTab} .notes-textarea`);a&&confirm(`⚠️ Limpar notas desta aba?`)&&(a.value='',this.saveNotes(!1),alert('✅ Notas limpas!'))}}}
if(!window.notesSystem&&window.NotesSystem){window.notesSystem=new window.NotesSystem()}
if(!window.notesInitialized){window.notesInitialized=!0,window.initNotesSystem=()=>window.NotesSystem&&!window.notesSystem&&(window.notesSystem=new window.NotesSystem()),window.openNotes=()=>window.notesSystem?.openNotes(),document.addEventListener('DOMContentLoaded',window.initNotesSystem)}